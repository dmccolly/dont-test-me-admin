<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DON'T TEST ME</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0a0a0a 100%);
      background-attachment: fixed;
      min-height: 100vh;
      display: flex; flex-direction: column; align-items: center;
      color: #fff; position: relative;
    }
    body::before {
      content: ''; position: fixed; inset: 0; pointer-events: none; z-index: 0;
      background:
        radial-gradient(circle at 20% 50%, rgba(120,119,198,.15) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255,119,198,.15) 0%, transparent 50%),
        radial-gradient(circle at 40% 80%, rgba(119,255,198,.15) 0%, transparent 50%);
    }
    .container {
      position: relative; z-index: 1; width: 100%; max-width: 500px;
      padding: 40px 20px; border: 1px solid rgba(255,255,255,.1);
      border-radius: 12px; background: rgba(0,0,0,.1);
    }
    .header { text-align: center; margin-bottom: 40px; position: relative; }
    .header::before {
      content: ''; position: absolute; top: -20px; left: 50%; transform: translateX(-50%);
      width: 300px; height: 60px; background: radial-gradient(ellipse, rgba(16,185,129,.25) 0%, transparent 70%);
      filter: blur(20px); z-index: -1;
    }
    .title {
      font-size: 3.5rem; font-weight: 200;
      background: linear-gradient(135deg, #ffffff 0%, #c4c4c4 50%, #a8a8a8 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
      margin-bottom: 12px; letter-spacing: -0.03em;
    }
    .subtitle { font-size: 1.1rem; color:#888; font-weight:300; letter-spacing:.3px; }
    .highlight{
      background: linear-gradient(135deg, #ffffff 0%, #c4c4c4 50%, #a8a8a8 100%);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; font-weight:400;
    }
    .message-ticker { text-align:center; margin:20px 0; min-height:30px; display:flex; align-items:center; justify-content:center; }
    .rotating-message{
      font-size:1rem; color:#fbbf24; font-weight:500; letter-spacing:.5px;
      text-shadow:0 2px 4px rgba(0,0,0,.5);
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #d97706 100%);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
      max-width:90%; word-wrap:break-word;
    }

    .tabs{ display:flex; justify-content:center; gap:20px; margin-bottom:30px; }
    .tab{
      padding:12px 20px; border:none; border-radius:12px; background:rgba(255,255,255,.05);
      backdrop-filter:blur(15px); border:1px solid rgba(255,255,255,.08); color:#888; font-size:.9rem; font-weight:500;
      cursor:pointer; transition:.3s; position:relative;
    }
    .tab.active{ background:rgba(16,185,129,.15); border:1px solid rgba(16,185,129,.3); color:#10b981; }
    .tab:hover{ background:rgba(255,255,255,.08); color:#ccc; }

    .panel{
      background:rgba(0,0,0,.3); backdrop-filter:blur(30px);
      border:1px solid rgba(255,255,255,.1); border-radius:24px; padding:30px;
      box-shadow:0 20px 40px rgba(0,0,0,.5); margin-bottom:30px;
    }
    .grid{ display:grid; grid-template-columns:repeat(6, 1fr); gap:8px; margin-bottom:36px; }
    .btn{
      aspect-ratio:1; border:none; border-radius:18px; cursor:pointer; transition:.3s; position:relative;
      color:rgba(255,255,255,.9); display:flex; align-items:center; justify-content:center;
      backdrop-filter:blur(20px); border:1px solid rgba(255,255,255,.12);
      box-shadow:0 6px 20px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.1);
      font-size:1.2rem; font-weight:600; text-shadow:0 2px 4px rgba(0,0,0,.5);
    }
    .btn.clicked{ animation: clickGlow .6s ease-out; }
    @keyframes clickGlow{
      0%{ box-shadow:0 6px 20px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.1); }
      50%{ box-shadow:0 6px 20px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.1), 0 0 30px rgba(255,255,255,.4); transform:scale(1.05); }
      100%{ box-shadow:0 6px 20px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.1); transform:scale(1); }
    }
    .btn::before{ content: attr(data-icon); position:absolute; font-size:1.4rem; font-weight:700; opacity:.8; text-shadow:0 2px 6px rgba(0,0,0,.7); }
    .btn.matched::after{
      content:'✓'; position:absolute; font-size:2rem; color:#10b981; font-weight:900; text-shadow:0 2px 8px rgba(16,185,129,.6);
      animation: checkmarkAppear .5s ease-out;
    }
    @keyframes checkmarkAppear{
      0%{ opacity:0; transform:scale(.5) rotate(-180deg); }
      50%{ opacity:1; transform:scale(1.2) rotate(-90deg); }
      100%{ opacity:1; transform:scale(1) rotate(0deg); }
    }
    .btn.row-0{ background:linear-gradient(145deg, rgba(219,154,154,.3), rgba(219,154,154,.15) 50%, rgba(180,120,120,.2)); border:1px solid rgba(219,154,154,.4); }
    .btn.row-1{ background:linear-gradient(145deg, rgba(154,219,154,.3), rgba(154,219,154,.15) 50%, rgba(120,180,120,.2)); border:1px solid rgba(154,219,154,.4); }
    .btn.row-2{ background:linear-gradient(145deg, rgba(154,154,219,.3), rgba(154,154,219,.15) 50%, rgba(120,120,180,.2)); border:1px solid rgba(154,154,219,.4); }
    .btn.row-3{ background:linear-gradient(145deg, rgba(219,219,154,.3), rgba(219,219,154,.15) 50%, rgba(180,180,120,.2)); border:1px solid rgba(219,219,154,.4); }
    .btn.row-4{ background:linear-gradient(145deg, rgba(219,154,219,.3), rgba(219,154,219,.15) 50%, rgba(180,120,180,.2)); border:1px solid rgba(219,154,219,.4); }
    .btn.row-5{ background:linear-gradient(145deg, rgba(154,219,219,.3), rgba(154,219,219,.15) 50%, rgba(120,180,180,.2)); border:1px solid rgba(154,219,219,.4); }
    .btn:hover{ transform: translateY(-3px); box-shadow:0 12px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.2), 0 0 30px rgba(255,255,255,.1); }
    .btn.matched{ background:linear-gradient(145deg, rgba(16,185,129,.25), rgba(5,150,105,.15) 50%, rgba(4,120,87,.1)); border:1px solid rgba(16,185,129,.2); color:#10b981; cursor:default; }
    .btn.matched::before{ opacity:0; }
    .btn.matched:hover{ transform:none; }

    .controls{ display:flex; gap:18px; align-items:center; justify-content:center; flex-wrap:wrap; }
    .stats{ display:flex; gap:30px; align-items:center; justify-content:center; margin-bottom:24px; flex-wrap:wrap; }
    .stat{ text-align:center; }
    .stat-label{ font-size:.8rem; color:#888; text-transform:uppercase; letter-spacing:.5px; margin-bottom:6px; }
    .stat-value{ font-size:1.8rem; font-weight:600; color:#fff; }
    .ctrl-btn{
      padding:12px 24px; border:none; border-radius:12px; background:rgba(255,255,255,.08);
      backdrop-filter:blur(15px); border:1px solid rgba(255,255,255,.12); color:#ccc; font-size:.9rem; font-weight:500; cursor:pointer; transition:.2s;
    }
    .ctrl-btn:hover{ background:rgba(255,255,255,.12); color:#fff; transform: translateY(-1px); }
    .timer-section{ text-align:center; margin-top:20px; }
    .current-stats{ font-size:1.1rem; color:#fff; margin-bottom:8px; }
    .best-stats{ font-size:.9rem; color:#888; }

    .win{ display:none; position:fixed; inset:0; background:rgba(0,0,0,.9); backdrop-filter:blur(20px); z-index:1000; align-items:center; justify-content:center; }
    .win.show{ display:flex; }
    .win-content{
      background:rgba(0,0,0,.8); backdrop-filter:blur(40px);
      border:1px solid rgba(255,255,255,.15); border-radius:28px; padding:60px 40px; text-align:center;
      box-shadow:0 25px 50px rgba(0,0,0,.7); max-width:90%; width:400px;
    }
    .win-title{
      font-size:2.5rem; font-weight:200; margin-bottom:20px;
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #d97706 100%);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
    }
    .win-stats{ font-size:1.1rem; color:#ccc; margin-bottom:40px; line-height:1.6; }
    .win-actions{ display:flex; gap:15px; justify-content:center; flex-wrap:wrap; }
    .win-btn{
      padding:12px 24px; border:none; border-radius:12px; background:rgba(255,255,255,.08);
      backdrop-filter:blur(15px); border:1px solid rgba(255,255,255,.12); color:#ccc; font-size:.9rem; font-weight:500; cursor:pointer; transition:.2s;
    }
    .win-btn:hover{ transform: translateY(-1px); box-shadow:0 6px 20px rgba(0,0,0,.3); }

    .admin-btn{
      position:absolute; top:10px; right:10px; padding:6px 10px; border:none; border-radius:6px;
      background:rgba(0,0,0,.2); backdrop-filter:blur(10px); border:1px solid rgba(255,255,255,.1);
      color:rgba(255,255,255,.6); font-size:.8rem; cursor:pointer; transition:.2s; opacity:.4;
    }
    .admin-btn:hover{ opacity:1; background:rgba(255,255,255,.05); color:#888; }

    /* Admin modal */
    .admin-panel{
      display:none; background:rgba(0,0,0,.6); backdrop-filter:blur(2px);
      position:fixed; inset:0; z-index:2000; align-items:center; justify-content:center;
    }
    .admin-panel.show{ display:flex; }
    .admin-dialog{
      width:min(92vw, 600px); background:rgba(0,0,0,.95); backdrop-filter:blur(40px);
      border:1px solid rgba(255,255,255,.15); border-radius:28px; padding:40px;
      box-shadow:0 25px 50px rgba(0,0,0,.7);
    }
    .admin-title{
      font-size:2rem; font-weight:200; margin-bottom:30px; text-align:center;
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #d97706 100%);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
    }
    .slot{ margin-bottom:30px; padding:25px; background:rgba(255,255,255,.03); backdrop-filter:blur(20px); border-radius:16px; border:1px solid rgba(255,255,255,.08); }
    .slot-header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; flex-wrap:wrap; gap:10px; }
    .slot-status{ color:#888; font-size:.9rem; }
    .upload{
      border:2px dashed rgba(255,255,255,.2); border-radius:12px; padding:40px 20px; text-align:center; cursor:pointer; transition:.2s; margin-bottom:15px;
    }
    .upload:hover, .upload.dragover{ border-color:rgba(16,185,129,.5); background:rgba(16,185,129,.05); }
    .upload-text{ font-size:1.1rem; color:#ccc; margin-bottom:8px; }
    .upload-hint{ font-size:.9rem; color:#888; }
    .admin-actions{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:20px; }
    .admin-btn-action{
      padding:10px 20px; border:none; border-radius:8px; font-size:.9rem; font-weight:500; cursor:pointer; transition:.2s;
      background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12); color:#ccc;
    }
    .admin-btn-action:hover{ background:rgba(255,255,255,.12); color:#fff; }
    .hidden-file{ display:none; }

    @media (max-width:768px){
      .title{ font-size:2.5rem; }
      .grid{ gap:6px; }
      .tabs{ flex-direction:column; gap:10px; }
      .tab{ width:100%; max-width:200px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <button class="admin-btn" onclick="showAdmin()">⚙</button>

    <div class="header">
      <h1 class="title">DON'T TEST ME</h1>
      <p class="subtitle">Here's one to test your hearing AND recall. Huh? <span class="highlight">I SAID. TO TEST YOUR HEARING AND RECALL!!</span></p>
      <div class="message-ticker">
        <div class="rotating-message" id="rotatingMessage">Welcome to the audio memory challenge!</div>
      </div>
    </div>

    <div class="tabs">
      <button class="tab active" onclick="switchGame(0)">Tones</button>
      <button class="tab" onclick="switchGame(1)" id="tab1">Custom Set 1</button>
      <button class="tab" onclick="switchGame(2)" id="tab2">Custom Set 2</button>
    </div>

    <div class="panel" id="gamePanel">
      <div class="grid" id="grid"></div>
      <div class="stats">
        <div class="stat">
          <div class="stat-label">Matches</div>
          <div class="stat-value" id="matches">0/18</div>
        </div>
        <div class="stat">
          <div class="stat-label">Attempts</div>
          <div class="stat-value" id="attempts">0</div>
        </div>
        <div class="stat">
          <div class="stat-label">Accuracy</div>
          <div class="stat-value" id="accuracy">100%</div>
        </div>
      </div>
      <div class="controls">
        <button class="ctrl-btn" onclick="resetGame()">New Game</button>
        <div class="timer-section">
          <div class="current-stats">Time: 0:00 | Attempts: 0</div>
          <div class="best-stats" id="bestStats">Best Time: -- | Best Attempts: --</div>
        </div>
        <button class="ctrl-btn" id="muteBtn" onclick="toggleAudio()">🔊 Audio On</button>
      </div>
    </div>
  </div>

  <!-- Admin Modal -->
  <div class="admin-panel" id="adminPanel" aria-hidden="true">
    <div class="admin-dialog" role="dialog" aria-modal="true" aria-labelledby="adminTitle">
      <h2 class="admin-title" id="adminTitle">Message Manager</h2>

      <div class="slot">
        <div class="slot-header">
          <div style="font-size:1.3rem; color:#fff;">Funny Messages</div>
          <div class="slot-status" id="messageStatus">No messages loaded</div>
        </div>

        <div class="upload" id="uploadBox">
          <div class="upload-text">📄 Upload message file (one phrase per line, 150 chars max)</div>
          <div class="upload-hint">Text file with your funny phrases</div>
          <input type="file" id="messageFile" class="hidden-file" accept=".txt">
        </div>

        <div class="admin-actions">
          <button class="admin-btn-action" onclick="previewMessages()">👀 Preview Messages</button>
          <button class="admin-btn-action" onclick="clearMessages()">🗑️ Clear Messages</button>
          <button class="admin-btn-action" onclick="hideAdmin()">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Win Modal -->
  <div class="win" id="win">
    <div class="win-content">
      <div class="win-title">Perfect Match!</div>
      <div class="win-stats" id="winStats">Completed in 0:00 with 0 attempts (100% accuracy)</div>
      <div class="win-actions">
        <button class="win-btn" onclick="playAgain()">Play Again</button>
        <button class="win-btn" onclick="scrambleGame(); hideWin();">Scramble</button>
        <button class="win-btn" onclick="showGameOptions()">Other Games</button>
      </div>
    </div>
  </div>

  <script>
    // ---------- Game State ----------
    let currentGame = 0;
    let sounds = [];
    let matched = new Set();
    let firstClick = null;
    let matches = 0;
    let attempts = 0;
    let muted = false;
    let audioContext = null;
    let currentAudioSources = [];
    let gameStartTime = null;
    let gameTimer = null;
    let currentTime = 0;
    let customBuffers = [[], []]; // reserved for future custom sets
    let funnyMessages = [];
    let messageTimer = null;
    let bestRecords = { 0:{time:null,attempts:null}, 1:{time:null,attempts:null}, 2:{time:null,attempts:null} };
    const frequencies = [220,246,261,293,329,349,392,440,493,523,587,659,698,783,880,987,1046,1174];

    // ---------- Message Rotation ----------
    function startMessageRotation(){
      const el = document.getElementById('rotatingMessage');
      el.textContent = "Welcome to the audio memory challenge!";
      setTimeout(()=>{
        el.textContent = "Click buttons to hear sounds, find matching pairs!";
        setTimeout(()=>{
          if (funnyMessages.length > 0){
            showRandomMessage();
            messageTimer = setInterval(showRandomMessage, 20000);
          } else {
            el.textContent = "Welcome to the audio memory challenge!";
          }
        }, 20000);
      }, 10000);
    }
    function stopMessageRotation(){ if(messageTimer){ clearInterval(messageTimer); messageTimer=null; } }
    function showRandomMessage(){
      if(!funnyMessages.length) return;
      const i = Math.floor(Math.random()*funnyMessages.length);
      const msg = funnyMessages[i];
      const el = document.getElementById('rotatingMessage');
      el.textContent = msg;
      setTimeout(()=>{ el.textContent = ""; }, 10000);
    }
    function loadMessages(){
      try{
        const saved = localStorage.getItem('dontTestMeMessages');
        if(saved){
          const arr = JSON.parse(saved);
          if(Array.isArray(arr) && arr.length) funnyMessages = arr;
        }
      }catch(e){ console.error('❌ Failed to load messages:', e); }
      startMessageRotation();
    }

    // ---------- Admin Panel ----------
    function showAdmin(){
      const panel = document.getElementById('adminPanel');
      panel.classList.add('show');
      panel.setAttribute('aria-hidden','false');
      updateMessageStatus();
    }
    function hideAdmin(){
      const panel = document.getElementById('adminPanel');
      panel.classList.remove('show');
      panel.setAttribute('aria-hidden','true');
    }
    // click outside dialog to close
    document.addEventListener('click', (e)=>{
      const panel = document.getElementById('adminPanel');
      if(!panel.classList.contains('show')) return;
      const dialog = e.target.closest('.admin-dialog');
      const isBtn = e.target.closest('.admin-btn');
      if(!dialog && !isBtn){ hideAdmin(); }
    });

    function updateMessageStatus(){
      const el = document.getElementById('messageStatus');
      el.textContent = funnyMessages.length ? `${funnyMessages.length} messages loaded` : 'No messages loaded';
    }

    function handleMessageFile(ev){
      const file = ev.target.files && ev.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = (e)=>{
        try{
          const text = String(e.target.result || '');
          const lines = text.split('\n').map(l=>l.trim()).filter(l=>l && l.length<=150);
          if(!lines.length){ alert('No valid messages found. Each line should be 1-150 characters.'); return; }
          funnyMessages = lines;
          saveMessages();
          updateMessageStatus();
          alert(`Successfully loaded ${funnyMessages.length} funny messages!`);
        }catch(err){
          console.error('Error loading messages:', err);
          alert('Error reading message file');
        }finally{
          ev.target.value = '';
        }
      };
      reader.readAsText(file);
    }

    function saveMessages(){
      try{ localStorage.setItem('dontTestMeMessages', JSON.stringify(funnyMessages)); }
      catch(e){ console.error('❌ Failed to save messages:', e); }
    }

    function previewMessages(){
      if(!funnyMessages.length){
        alert('No messages loaded. Please upload a message file first.');
        return;
      }
      const preview = funnyMessages.slice(0,10).join('\n');
      const more = funnyMessages.length > 10 ? `\n\n...and ${funnyMessages.length - 10} more messages.` : '';
      alert(`Preview of your messages:\n\n${preview}${more}`);
    }

    function clearMessages(){
      if(!funnyMessages.length){ alert('Nothing to clear.'); return; }
      if(confirm('Clear all funny messages?')){
        funnyMessages = [];
        try{ localStorage.removeItem('dontTestMeMessages'); }catch(e){}
        updateMessageStatus();
        alert('Messages cleared successfully!');
      }
    }

    // wire upload box after DOM loaded
    document.addEventListener('DOMContentLoaded', ()=>{
      const uploadBox = document.getElementById('uploadBox');
      const fileInput = document.getElementById('messageFile');
      uploadBox.addEventListener('click', ()=> fileInput.click());
      fileInput.addEventListener('change', handleMessageFile);
    });

    // ---------- Audio / Game ----------
    function initAudio(){
      try{ audioContext = new (window.AudioContext || window.webkitAudioContext)(); }
      catch(e){ console.error('Audio context not supported:', e); }
    }
    function generateTone(freq, duration=.5){
      if(!audioContext) return null;
      const sr = audioContext.sampleRate;
      const n = Math.floor(sr * duration);
      const buffer = audioContext.createBuffer(1, n, sr);
      const data = buffer.getChannelData(0);
      for(let i=0;i<n;i++){
        const t = i/sr;
        const env = Math.exp(-t*2);
        data[i] = Math.sin(2*Math.PI*freq*t) * env * 0.3;
      }
      return buffer;
    }
    function playAudioBuffer(buffer){
      if(!audioContext || !buffer || muted) return;
      stopAllAudio();
      const src = audioContext.createBufferSource();
      src.buffer = buffer; src.connect(audioContext.destination); src.start();
      currentAudioSources.push(src);
      src.onended = ()=> {
        const idx = currentAudioSources.indexOf(src);
        if(idx>-1) currentAudioSources.splice(idx,1);
      };
    }
    function stopAllAudio(){ currentAudioSources.forEach(s=>{ try{s.stop();}catch(_){}}); currentAudioSources=[]; }
    function playSound(index){
      if(currentGame===0){
        const buf = generateTone(frequencies[index]);
        if(buf) playAudioBuffer(buf);
      }else{
        const slot = currentGame-1;
        if(customBuffers[slot] && customBuffers[slot][index]) playAudioBuffer(customBuffers[slot][index]);
      }
    }
    function createGrid(){
      const grid = document.getElementById('grid'); grid.innerHTML='';
      for(let i=0;i<36;i++){
        const btn = document.createElement('button');
        btn.className = `btn row-${Math.floor(i/6)}`;
        btn.onclick = ()=> handleClick(i);
        btn.setAttribute('data-icon','🔊');
        grid.appendChild(btn);
      }
    }
    function generateSounds(){
      const idxs = [];
      for(let i=0;i<18;i++){ idxs.push(i,i); }
      for(let i=idxs.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [idxs[i], idxs[j]] = [idxs[j], idxs[i]];
      }
      sounds = idxs;
    }
    function handleClick(i){
      if(matched.has(i)) return;
      const btn = document.querySelectorAll('.btn')[i];
      btn.classList.add('clicked'); setTimeout(()=>btn.classList.remove('clicked'), 600);

      if(!gameStartTime){ gameStartTime = Date.now(); startTimer(); }

      playSound(sounds[i]);

      if(firstClick===null){ firstClick = i; }
      else if(firstClick===i){ firstClick = null; }
      else{
        attempts++; updateStats();
        if(sounds[firstClick]===sounds[i]){
          matched.add(firstClick); matched.add(i); matches++;
          const b1 = document.querySelectorAll('.btn')[firstClick];
          const b2 = document.querySelectorAll('.btn')[i];
          b1.classList.add('matched'); b2.classList.add('matched');
          if(matches===18){ stopTimer(); showWin(); updateBestRecord(); }
        }
        firstClick = null;
      }
    }
    function startTimer(){ gameTimer = setInterval(()=>{ currentTime = Math.floor((Date.now()-gameStartTime)/1000); updateTimerDisplay(); }, 1000); }
    function stopTimer(){ if(gameTimer){ clearInterval(gameTimer); gameTimer=null; } }
    function updateTimerDisplay(){
      const m = Math.floor(currentTime/60), s = currentTime%60, t = `${m}:${String(s).padStart(2,'0')}`;
      const cur = document.querySelector('.current-stats'); if(cur) cur.textContent = `Time: ${t} | Attempts: ${attempts}`;
    }
    function updateStats(){
      document.getElementById('matches').textContent = `${matches}/18`;
      document.getElementById('attempts').textContent = attempts;
      const acc = attempts===0 ? 100 : Math.round((matches/attempts)*100);
      document.getElementById('accuracy').textContent = `${acc}%`;
    }
    function updateBestStats(){
      const rec = bestRecords[currentGame]; const el = document.getElementById('bestStats');
      if(rec.time!==null && rec.attempts!==null){
        const m = Math.floor(rec.time/60), s = rec.time%60, t = `${m}:${String(s).padStart(2,'0')}`;
        el.textContent = `Best Time: ${t} | Best Attempts: ${rec.attempts}`;
      } else el.textContent = 'Best Time: -- | Best Attempts: --';
    }
    function updateBestRecord(){
      const rec = bestRecords[currentGame];
      const better = rec.time===null || currentTime < rec.time || (currentTime===rec.time && attempts<rec.attempts);
      if(better){ bestRecords[currentGame] = { time:currentTime, attempts }; saveRecords(); updateBestStats(); }
    }
    function saveRecords(){ localStorage.setItem('dontTestMeRecords', JSON.stringify(bestRecords)); }
    function loadRecords(){ const s = localStorage.getItem('dontTestMeRecords'); if(s){ bestRecords = { ...bestRecords, ...JSON.parse(s) }; } }
    function showWin(){
      const m = Math.floor(currentTime/60), s = currentTime%60, t = `${m}:${String(s).padStart(2,'0')}`;
      const acc = Math.round((matches/attempts)*100);
      document.getElementById('winStats').textContent = `Completed in ${t} with ${attempts} attempts (${acc}% accuracy)`;
      document.getElementById('win').classList.add('show');
    }
    function hideWin(){ document.getElementById('win').classList.remove('show'); }
    function playAgain(){ hideWin(); resetGame(); }
    function showGameOptions(){ hideWin(); alert('Use the game tabs above to switch between different sound sets!'); }
    function resetGame(){
      stopTimer(); sounds=[]; matched=new Set(); firstClick=null; matches=0; attempts=0; gameStartTime=null; currentTime=0;
      hideWin(); generateSounds(); createGrid(); updateStats(); updateTimerDisplay(); updateBestStats();
    }
    function scrambleGame(){
      if(!sounds.length){ resetGame(); return; }
      stopTimer();
      for(let i=sounds.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [sounds[i], sounds[j]]=[sounds[j], sounds[i]];
      }
      matched=new Set(); firstClick=null; matches=0; attempts=0; gameStartTime=null; currentTime=0; hideWin();
      document.querySelectorAll('.btn').forEach((b,i)=>{ b.className=`btn row-${Math.floor(i/6)}`; });
      updateStats(); updateTimerDisplay(); updateBestStats();
    }
    function toggleAudio(){ muted=!muted; document.getElementById('muteBtn').innerHTML = muted ? '🔇 Audio Off' : '🔊 Audio On'; }
    function switchGame(i){
      currentGame = i;
      document.querySelectorAll('.tab').forEach((t,idx)=> t.classList.toggle('active', idx===i));
      resetGame(); updateBestStats();
    }

    // ---------- Init ----------
    document.addEventListener('DOMContentLoaded', ()=>{
      initAudio();
      loadRecords();
      loadMessages();
      generateSounds();
      createGrid();
      updateStats();
      updateTimerDisplay();
      updateBestStats();
    });
    document.addEventListener('click', ()=>{ if(audioContext && audioContext.state==='suspended') audioContext.resume(); });
    document.addEventListener('visibilitychange', ()=>{ if(document.hidden) stopAllAudio(); });
    window.addEventListener('beforeunload', ()=>{ stopMessageRotation(); try{ saveRecords(); }catch(_){} });
  </script>
</body>
</html>